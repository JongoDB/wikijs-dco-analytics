---
title: WannaCry
type: malware
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1071", "T1071.001", "T1486", "T1490"]
---

# WannaCry

## Overview

WannaCry is a ransomware malware that gained worldwide attention in May 2017 for its rapid spread and devastating impact. It exploits the EternalBlue vulnerability in Windows SMB protocol to spread across networks and encrypts files on infected systems, demanding ransom payments in Bitcoin.

## Observed Behavior & Capabilities

### Primary Functions
- **Ransomware**: Encrypts files and demands ransom payments
- **Network Propagation**: Spreads automatically across networks using SMB exploits
- **Cryptocurrency Payment**: Demands Bitcoin ransom payments
- **Mass Distribution**: Designed for rapid, widespread infection

### Key Capabilities
- **EternalBlue Exploit**: Uses CVE-2017-0144 SMB vulnerability
- **DoublePulsar Backdoor**: May install backdoor for persistent access
- **File Encryption**: Encrypts files with strong encryption
- **Payment Processing**: Integrated Bitcoin payment system

## Technical Details

### Exploitation Method
- **Vulnerability**: CVE-2017-0144 (EternalBlue)
- **Protocol**: SMB (Server Message Block)
- **Port**: TCP 445
- **Operating Systems**: Windows systems with unpatched SMB

### File Characteristics
- **File Extensions**: Adds .WCRY extension to encrypted files
- **Ransom Note**: Creates README.txt files with ransom instructions
- **Payment**: Demands Bitcoin payments to specific addresses

### Network Behavior
- **Propagation**: Uses SMB protocol for network spread
- **Communication**: May communicate with C2 servers
- **Traffic**: Generates significant network traffic during propagation

## Detection Methods

### Network Detection
```suricata
alert smb any any -> any any (msg:"WannaCry - SMBv1 Exploit Attempt"; content:"|SMBv1 exploit|"; sid:2025100606; rev:1;)

alert tcp any any -> any 445 (msg:"WannaCry - Potential SMB Exploitation"; content:"|EternalBlue|"; sid:2025100607; rev:1;)
```

### Host Detection
```powershell
# PowerShell detection for WannaCry files
Get-ChildItem -Path "C:\" -Recurse -Filter "*.WCRY" -ErrorAction SilentlyContinue

# Check for ransom notes
Get-ChildItem -Path "C:\" -Recurse -Filter "README.txt" -ErrorAction SilentlyContinue
```

### Behavioral Indicators
- **File Encryption**: Rapid encryption of files with .WCRY extension
- **Ransom Notes**: Creation of README.txt files
- **SMB Traffic**: Unusual SMB traffic patterns
- **Process Behavior**: Suspicious processes accessing multiple files

## Hunting Queries

### Splunk Search
```splunk
index=wineventlog* (EventCode=4656 OR EventCode=4663) (ObjectName="*.WCRY" OR ProcessName="*WannaCry*")
| stats count by host, user, ObjectName, ProcessName
```

### KQL Query
```kql
DeviceFileEvents
| where FileName endswith ".WCRY" or FileName == "README.txt"
| project Timestamp, DeviceName, AccountName, FileName, FolderPath
```

## Mitigation Strategies

### Prevention
- **Patch Management**: Apply MS17-010 security update immediately
- **SMB Security**: Disable SMBv1 if not needed
- **Network Segmentation**: Isolate critical systems
- **Backup Strategy**: Maintain regular, offline backups

### Detection
- **Endpoint Protection**: Deploy EDR solutions with ransomware detection
- **Network Monitoring**: Monitor for SMB exploit attempts
- **File Monitoring**: Monitor for rapid file encryption

### Response
- **Incident Response**: Have procedures for ransomware incidents
- **System Isolation**: Isolate infected systems immediately
- **Recovery**: Use clean backups for system recovery
- **Forensic Analysis**: Preserve evidence for investigation

## IOCs (Indicators of Compromise)

### File Hashes
- **MD5**: 4DA1F312A214C07143ABEEAFB695D904
- **SHA1**: 5bef35496fcbdbe841c82f4d1ab8b7c2

### File Extensions
- `.WCRY` - Encrypted files
- `README.txt` - Ransom notes

### Network Indicators
- **Port**: TCP 445 (SMB)
- **Protocol**: SMBv1

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1486 | Data Encrypted for Impact | Impact |
| T1490 | Inhibit System Recovery | Impact |

## References

- [CISA Alert - WannaCry Ransomware](https://www.cisa.gov/news-events/cybersecurity-advisories/)
- [Microsoft Security Bulletin MS17-010](https://docs.microsoft.com/en-us/security-updates/)
- [MITRE ATT&CK - Data Encrypted for Impact](https://attack.mitre.org/techniques/T1486/)
