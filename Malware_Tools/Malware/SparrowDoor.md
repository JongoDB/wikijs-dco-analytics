---
title: SparrowDoor
type: malware
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1003", "T1071", "T1071.001", "T1071.004", "T1090", "T1115", "T1547"]
---

# SparrowDoor

## Overview

SparrowDoor is a custom Windows backdoor family exclusively associated with the China-linked espionage group FamousSparrow. First identified around 2019, SparrowDoor is primarily used for persistent remote access in targeted networks, enabling stealthy reconnaissance and data exfiltration capabilities.

## Observed Behavior & Capabilities

### Primary Functions
- **Persistent Backdoor**: Establishes long-term access to compromised systems
- **Reconnaissance**: Conducts stealthy reconnaissance activities
- **Data Exfiltration**: Facilitates data theft through encrypted channels
- **Lateral Movement**: Provides platform for launching further attacks

### Key Capabilities
- **Stealth Operation**: Designed for long-term undetected operation
- **HTTPS Communication**: Uses HTTPS for command and control
- **Service Persistence**: Installs as Windows service for persistence
- **Token Impersonation**: Can impersonate user tokens for privilege escalation

## Technical Details

### Architecture & Components
- **Loader Component**: Initial loader (typically libcurl.dll)
- **Payload Component**: Main backdoor (typically libhost.dll)
- **Service Installation**: Installs as "SearchIndexer" service
- **Registry Persistence**: Creates registry entries for persistence

### File Characteristics
- **Loader**: libcurl.dll (32-bit)
- **Backdoor**: libhost.dll
- **Service**: SearchIndexer.exe in C:\ProgramData\Microsoft\DRM\
- **Registry**: HKLM\SYSTEM\CurrentControlSet\Services\SearchIndexer

### Network Behavior
- **Protocol**: HTTPS over port 443 (sometimes port 80)
- **Encryption**: Uses TLS for encrypted communication
- **Beacon Patterns**: Variable beacon intervals to avoid detection
- **DNS Resolution**: May use DNS for C2 resolution

## Detection Methods

### Network Detection
```suricata
alert tls $HOME_NET any -> $EXTERNAL_NET 443 (msg:"SparrowDoor TLS C2 Possible"; tls.sni; content:"suspicious_domain"; sid:2025100604; rev:1;)

alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"SparrowDoor suspected C2 domain"; dns_query; content:"suspicious_domain"; sid:2025100605; rev:1;)
```

### Host Detection
```powershell
# PowerShell detection for SparrowDoor service
Get-Service -Name "SearchIndexer" | Where-Object {$_.Path -like "*ProgramData\Microsoft\DRM\*"}

# Registry detection
Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\SearchIndexer" -ErrorAction SilentlyContinue
```

### Behavioral Indicators
- **Service Creation**: Creation of "SearchIndexer" service in ProgramData
- **Registry Modifications**: Suspicious registry entries
- **Network Connections**: HTTPS connections to suspicious domains
- **File System**: Presence of suspicious DLL files

## Hunting Queries

### Splunk Search
```splunk
index=wineventlog* (ServiceName="SearchIndexer" OR ProcessName="SearchIndexer.exe")
| stats count by host, user, ServiceName, ProcessName, ImagePath
```

### KQL Query
```kql
DeviceProcessEvents
| where ProcessCommandLine contains "SearchIndexer" or ProcessCommandLine contains "libcurl.dll"
| project Timestamp, DeviceName, AccountName, ProcessCommandLine
```

## Mitigation Strategies

### Prevention
- **Patch Management**: Keep systems updated with latest security patches
- **Network Segmentation**: Isolate critical systems from internet access
- **Access Controls**: Implement strict access controls on network devices
- **User Training**: Educate users about social engineering attacks

### Detection
- **Endpoint Protection**: Deploy EDR solutions with SparrowDoor detection
- **Network Monitoring**: Monitor for suspicious HTTPS traffic patterns
- **Service Monitoring**: Regular monitoring of Windows services

### Response
- **Incident Response**: Have procedures for backdoor removal
- **Forensic Analysis**: Preserve evidence for investigation
- **System Recovery**: Ensure clean backups for system recovery

## IOCs (Indicators of Compromise)

### File Hashes
- **Loader**: e0b107be8034976f6e91cfcc2bbc792b49ea61a071166968fec775af28b1f19c
- **Backdoor**: [Additional hashes available in threat intelligence feeds]

### Registry Keys
- `HKLM\SYSTEM\CurrentControlSet\Services\SearchIndexer`

### File Paths
- `C:\ProgramData\Microsoft\DRM\SearchIndexer.exe`

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1003 | OS Credential Dumping | Credential Access |
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1071.004 | Application Layer Protocol: DNS | Command and Control |
| T1090 | Proxy | Command and Control |
| T1115 | Clipboard Data | Collection |
| T1547 | Boot or Logon Autostart Execution | Persistence |

## References

- [NCSC Malware Analysis Report: SparrowDoor (Feb 2022)](https://www.ncsc.gov.uk/files/NCSC-MAR-SparrowDoor-indicators.csv)
- [MITRE ATT&CK - Boot or Logon Autostart Execution](https://attack.mitre.org/techniques/T1547/)
- [CISA Alert - Chinese State-Sponsored Threats](https://www.cisa.gov/news-events/cybersecurity-advisories/)
