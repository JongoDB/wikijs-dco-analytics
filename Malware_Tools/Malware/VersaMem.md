---
title: VersaMem
type: malware
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1003", "T1033", "T1059.003", "T1071", "T1071.001", "T1505.003", "T1547"]
---

# VersaMem

## Overview

VersaMem is a custom web shell backdoor designed specifically for Versa Director SD-WAN management servers. Discovered in mid-2024, VersaMem was implanted by exploiting a zero-day vulnerability and is tightly linked to the Volt Typhoon campaign targeting U.S. telecom and critical infrastructure networks.

## Observed Behavior & Capabilities

### Primary Functions
- **Web Shell Backdoor**: Provides persistent access to Versa Director servers
- **Credential Harvesting**: Intercepts and steals authentication credentials
- **Memory Injection**: Injects into running Java/Tomcat processes
- **Network Pivoting**: Enables access to downstream customer networks

### Key Capabilities
- **In-Memory Persistence**: Operates entirely in memory without file system artifacts
- **Credential Interception**: Hooks authentication methods to capture passwords
- **Java Process Injection**: Uses Java Attach API to inject into Tomcat processes
- **Encrypted Storage**: Uses AES encryption for stolen credential storage

## Technical Details

### Architecture
- **Type**: Java JAR web shell
- **Platform**: Network appliances (Versa Director SD-WAN)
- **Persistence**: In-memory only (no file system persistence)
- **Injection Target**: Apache Tomcat process (org.apache.catalina.startup.Bootstrap)

### Persistence Mechanism
VersaMem achieves persistence in-memory by:
1. Finding the Tomcat process ID via `pgrep`
2. Using Java VirtualMachine.attach() API
3. Injecting into the running Tomcat process
4. Setting up hooks for credential interception

### Network Behavior
- **No Outbound C2**: Does not initiate network connections
- **Web Interface**: Accessed via HTTPS on normal web port (443)
- **Parameter-Based**: Uses specific URL parameters for command execution
- **Encrypted Communication**: Uses HTTPS for all communications

## Detection Methods

### Network Detection
```suricata
# VersaMem web shell access patterns
alert http any any -> any any (msg:"VersaMem - Suspicious Web Shell Access"; http_uri; content:"/login.jsp"; http_uri; content:"PSWD="; sid:2025104001; rev:1;)

# VersaMem parameter patterns
alert http any any -> any any (msg:"VersaMem - Suspicious Parameters"; http_uri; content:"JAVACMD="; sid:2025104002; rev:1;)
```

### Host Detection
```powershell
# Java process monitoring for VersaMem injection
Get-Process | Where-Object {$_.ProcessName -like "*java*" -and $_.Modules.ModuleName -contains "suspicious_module"}

# Tomcat process analysis
$tomcatProcess = Get-Process | Where-Object {$_.ProcessName -like "*tomcat*"}
if ($tomcatProcess) {
    # Analyze process memory for VersaMem artifacts
    Write-Host "Tomcat process found: $($tomcatProcess.Id)"
}
```

### Behavioral Indicators
- **Java Process Anomalies**: Unusual Java process behavior or memory usage
- **Credential Storage**: Presence of encrypted credential files
- **Web Access Patterns**: Suspicious web interface access patterns
- **Memory Artifacts**: In-memory web shell indicators

## Hunting Queries

### Splunk Searches
```splunk
# VersaMem web shell access
index=web* (url="*login.jsp*" AND url="*PSWD=*") OR (url="*JAVACMD=*")
| stats count by src_ip, dest_ip, user, url

# Java process anomalies
index=sysmon* EventCode=1 (Image="*java*" AND CommandLine="*tomcat*")
| stats count by host, user, Image, CommandLine
```

### KQL Queries
```kql
// VersaMem web shell detection
DeviceNetworkEvents
| where RemoteUrl contains "login.jsp" and RemoteUrl contains "PSWD="
| project Timestamp, DeviceName, RemoteUrl, InitiatingProcessFileName

// Java process monitoring
DeviceProcessEvents
| where ProcessCommandLine contains "tomcat" or ProcessCommandLine contains "catalina"
| project Timestamp, DeviceName, ProcessCommandLine, InitiatingProcessFileName
```

## IOCs (Indicators of Compromise)

### File Hashes
- **SHA-256**: 4BCEDAC20A75E8F8833F4725ADFC87577C32990C3783BF6C743F14599A176C37

### Network Indicators
- **URL Patterns**: `/login.jsp?PSWD=`, `/login.jsp?JAVACMD=`
- **Ports**: 443 (HTTPS)
- **Protocols**: HTTPS with suspicious parameters

### Behavioral Indicators
- **Java Process**: Unusual Tomcat process behavior
- **Memory Artifacts**: In-memory web shell indicators
- **Credential Files**: Encrypted credential storage files

## Mitigation Strategies

### Prevention
- **Patch Management**: Keep Versa Director systems updated
- **Network Segmentation**: Isolate SD-WAN management interfaces
- **Access Controls**: Implement strict access controls on management interfaces
- **Monitoring**: Deploy comprehensive monitoring on network appliances

### Detection
- **File Integrity Monitoring**: Monitor Versa Director installation directories
- **Process Monitoring**: Monitor Java/Tomcat processes for anomalies
- **Network Monitoring**: Monitor for suspicious web interface access
- **Memory Analysis**: Regular memory analysis of critical processes

### Response
- **Incident Response**: Have procedures for network appliance compromise
- **Forensic Analysis**: Preserve memory dumps for analysis
- **System Recovery**: Ensure clean backups for system recovery
- **Credential Rotation**: Rotate all potentially compromised credentials

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1003 | OS Credential Dumping | Credential Access |
| T1033 | System Owner/User Discovery | Discovery |
| T1059.003 | Command and Scripting Interpreter: Windows Command Shell | Execution |
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1505.003 | Server Software Component: Web Shell | Persistence |
| T1547 | Boot or Logon Autostart Execution | Persistence |

## References

- [Lumen Blog - Versa Director Zero-Day (VersaMem)](https://blog.lumen.com/)
- [MITRE ATT&CK - VersaMem](https://attack.mitre.org/software/S1154/)
- [CISA Alert - Volt Typhoon](https://www.cisa.gov/news-events/cybersecurity-advisories/)
