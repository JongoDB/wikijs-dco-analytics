---
title: MagicRat
type: malware
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1055.001", "T1071", "T1071.001", "T1071.004", "T1218.011", "T1547", "T1560", "T1573"]
---

# MagicRat

## Overview

MagicRat is a sophisticated remote access trojan (RAT) developed by North Korean state-sponsored threat actors. This malware is designed to provide persistent access to compromised systems and enable various post-exploitation activities including data theft, system reconnaissance, and lateral movement.

## Observed Behavior & Capabilities

### Primary Functions
- **Remote Access**: Provides persistent remote access to compromised systems
- **System Reconnaissance**: Gathers information about the target environment
- **Command Execution**: Executes commands and scripts on the target system
- **Data Exfiltration**: Steals sensitive data from compromised systems

### Key Capabilities
- **Qt-Based**: Built using Qt framework for cross-platform compatibility
- **Obfuscation**: Uses obfuscation techniques to evade detection
- **Process Injection**: Uses process injection for stealth
- **Command and Control**: Communicates with C2 infrastructure

## Technical Details

### Architecture
- **Type**: Remote Access Trojan (RAT)
- **Platform**: Windows and Linux systems
- **Framework**: Qt-based application
- **Communication**: HTTP/HTTPS for C2 communication
- **Persistence**: Various persistence mechanisms including registry and service installation

### Network Behavior
- **Protocols**: HTTP/HTTPS for C2 communication
- **Encryption**: May use encryption for C2 communications
- **Beaconing**: Regular beaconing to C2 infrastructure
- **Data Exfiltration**: Uses C2 channel for data theft

## Detection Methods

### Network Detection
```suricata
# MagicRat C2 Communication
alert tcp any any -> any any (msg:"MagicRat - C2 Communication"; content:"|MAGICRAT_MAGIC_STRING|"; flow:established,to_server; sid:2025104037; rev:1;)

# MagicRat HTTP C2
alert http any any -> any any (msg:"MagicRat - HTTP C2 Communication"; http_uri; content:"/c2"; sid:2025104038; rev:1;)

# MagicRat DNS C2
alert dns any any -> any 53 (msg:"MagicRat - DNS C2 Communication"; dns_query; content:"suspicious_domain"; sid:2025104039; rev:1;)
```

### Host Detection
```powershell
# MagicRat process detection
Get-Process | Where-Object {$_.ProcessName -match "magicrat" -or $_.CommandLine -match "magicrat"}

# Suspicious service creation
Get-Service | Where-Object {$_.Name -match "magicrat" -or $_.DisplayName -match "magicrat"}
```

### Behavioral Indicators
- **Network Connections**: Unusual outbound HTTP/HTTPS connections
- **Process Creation**: Suspicious process creation patterns
- **Registry Modifications**: Unusual registry modifications
- **File System Changes**: Suspicious file creation and modification

## Hunting Queries

### Splunk Searches
```splunk
# MagicRat network activity
index=network* (url="*c2*" OR url="*magicrat*") OR (user_agent="*magicrat*")
| stats count by src_ip, dest_ip, url, user_agent

# MagicRat process activity
index=sysmon* EventCode=1 (Image="*magicrat*" OR CommandLine="*magicrat*")
| stats count by host, user, Image, CommandLine
```

### KQL Queries
```kql
// MagicRat network detection
DeviceNetworkEvents
| where RemoteUrl contains "magicrat" or RemoteUrl contains "c2"
| project Timestamp, DeviceName, RemoteUrl, InitiatingProcessFileName

// MagicRat process detection
DeviceProcessEvents
| where ProcessCommandLine contains "magicrat" or FileName contains "magicrat"
| project Timestamp, DeviceName, FileName, ProcessCommandLine
```

## IOCs (Indicators of Compromise)

### File Indicators
- **File Names**: [Known MagicRat file names from threat intelligence]
- **File Hashes**: [Known MagicRat file hashes from threat intelligence]
- **File Locations**: [Known MagicRat file locations from threat intelligence]

### Network Indicators
- **C2 Domains**: [Known C2 domains from threat intelligence]
- **IP Addresses**: [Known C2 IP addresses]
- **Ports**: 80, 443 (HTTP/HTTPS)

### Behavioral Indicators
- **Process Names**: Suspicious process names
- **Registry Keys**: Unusual registry modifications
- **File Paths**: Suspicious file creation patterns

## Mitigation Strategies

### Prevention
- **Endpoint Protection**: Deploy EDR solutions with RAT detection
- **Network Monitoring**: Monitor for suspicious network connections
- **Access Controls**: Implement strict access controls
- **Patch Management**: Keep systems updated with latest security patches

### Detection
- **Network Monitoring**: Monitor for suspicious HTTP/HTTPS traffic
- **Process Monitoring**: Monitor for suspicious process creation
- **Registry Monitoring**: Monitor for suspicious registry modifications
- **File System Monitoring**: Monitor for suspicious file operations

### Response
- **Incident Response**: Have procedures for RAT incidents
- **Forensic Analysis**: Preserve evidence for investigation
- **System Recovery**: Use clean backups for system recovery
- **Credential Rotation**: Rotate potentially compromised credentials

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1055.001 | Process Injection: Dynamic-link Library Injection | Defense Evasion |
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1071.004 | Application Layer Protocol: DNS | Command and Control |
| T1218.011 | Signed Binary Proxy Execution: Rundll32 | Defense Evasion |
| T1547 | Boot or Logon Autostart Execution | Persistence |
| T1560 | Archive Collected Data | Collection |
| T1573 | Encrypted Channel | Command and Control |

## References

- [CISA Alert - North Korean State-Sponsored Threats](https://www.cisa.gov/news-events/cybersecurity-advisories/)
- [MITRE ATT&CK - MagicRat](https://attack.mitre.org/software/)
- [FBI Guidance - North Korean Cyber Threats](https://www.fbi.gov/)
