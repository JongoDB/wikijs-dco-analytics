---
title: Whoami
type: tool
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1003", "T1016", "T1033", "T1049", "T1059.003", "T1071", "T1071.001", "T1071.004", "T1136", "T1547"]
---

# Whoami

## Overview

Whoami is a standard Windows command-line utility that displays information about the current user context and privileges. While this is a legitimate Windows tool, it is commonly abused by attackers for system discovery and reconnaissance during post-exploitation activities.

## Observed Behavior & Capabilities

### Primary Functions
- **User Context Discovery**: Displays current username and user SID
- **Privilege Information**: Shows user privileges and group memberships
- **System Reconnaissance**: Provides information about the current user context
- **Domain Information**: Reveals domain membership and role information

### Key Capabilities
- **Built-in Windows Tool**: Located in %SystemRoot%\System32\whoami.exe
- **No Special Privileges**: Requires no special privileges to run
- **Multiple Output Formats**: Supports various output formats (CSV, table, etc.)
- **Group Information**: Can display group memberships and privileges

## Technical Details

### Architecture
- **Type**: Windows Command-Line Utility
- **Platform**: Windows-based systems
- **Location**: %SystemRoot%\System32\whoami.exe
- **Persistence**: No persistence mechanisms (purely informational)

### Command Line Options
- **whoami**: Display current username
- **whoami /groups**: Display group memberships
- **whoami /priv**: Display user privileges
- **whoami /all**: Display comprehensive user information
- **whoami /fo csv**: Output in CSV format
- **whoami /nh**: No header output

## Detection Methods

### Network Detection
```suricata
# Whoami output in network traffic
alert http any any -> any any (msg:"Whoami - Output in Network Traffic"; content:"User name"; content:"SID"; sid:2025104010; rev:1;)

# Whoami command execution via web shell
alert http any any -> any any (msg:"Whoami - Command Execution"; http_uri; content:"whoami"; sid:2025104011; rev:1;)
```

### Host Detection
```powershell
# Whoami process detection
Get-Process | Where-Object {$_.ProcessName -eq "whoami"}

# Whoami command line detection
Get-WinEvent -LogName Security | Where-Object {
    $_.ID -eq 4688 -and 
    $_.Properties[1].Value -like "*whoami*"
} | Select-Object TimeCreated, Message
```

### Behavioral Indicators
- **Non-Interactive Execution**: Whoami run by non-interactive processes
- **Frequent Usage**: Whoami executed on multiple hosts
- **Suspicious Parent Processes**: Whoami launched by suspicious parent processes
- **Command Line Parameters**: Use of specific whoami parameters

## Hunting Queries

### Splunk Searches
```splunk
# Whoami execution detection
index=wineventlog* EventCode=4688 (NewProcessName="*whoami.exe*" AND ParentProcessName!="explorer.exe")
| stats count by host, user, NewProcessName, ParentProcessName, CommandLine

# Whoami with suspicious parameters
index=wineventlog* EventCode=4688 (NewProcessName="*whoami.exe*" AND CommandLine="*whoami /all*")
| stats count by host, user, CommandLine
```

### KQL Queries
```kql
// Whoami execution detection
DeviceProcessEvents
| where FileName == "whoami.exe" and InitiatingProcessFileName != "explorer.exe"
| project Timestamp, DeviceName, FileName, ProcessCommandLine, InitiatingProcessFileName

// Whoami with suspicious parameters
DeviceProcessEvents
| where ProcessCommandLine contains "whoami /all" or ProcessCommandLine contains "whoami /groups"
| project Timestamp, DeviceName, ProcessCommandLine, InitiatingProcessFileName
```

## IOCs (Indicators of Compromise)

### Process Indicators
- **Process Name**: whoami.exe
- **Parent Processes**: Suspicious parent processes (w3wp.exe, powershell.exe, etc.)
- **Command Lines**: Specific whoami parameters and usage patterns
- **Execution Context**: Non-interactive execution contexts

### Behavioral Indicators
- **Execution Patterns**: Frequent whoami execution across multiple hosts
- **Parameter Usage**: Use of specific whoami parameters (/all, /groups, /priv)
- **Output Redirection**: Whoami output redirected to files
- **Temporal Patterns**: Whoami execution in suspicious timeframes

## Mitigation Strategies

### Prevention
- **Endpoint Protection**: Deploy EDR solutions with process monitoring
- **Access Controls**: Implement strict access controls and user monitoring
- **Patch Management**: Keep systems updated with latest security patches
- **User Training**: Educate users about suspicious command usage

### Detection
- **Process Monitoring**: Monitor for suspicious whoami execution
- **Command Line Auditing**: Enable command-line process auditing
- **Behavioral Analysis**: Look for suspicious whoami usage patterns
- **Network Monitoring**: Monitor for whoami output in network traffic

### Response
- **Incident Response**: Have procedures for suspicious command execution
- **Forensic Analysis**: Preserve evidence for investigation
- **User Investigation**: Investigate user accounts associated with suspicious activity
- **System Recovery**: Use clean backups for system recovery if needed

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1003 | OS Credential Dumping | Credential Access |
| T1016 | System Network Configuration Discovery | Discovery |
| T1033 | System Owner/User Discovery | Discovery |
| T1049 | System Network Connections Discovery | Discovery |
| T1059.003 | Command and Scripting Interpreter: Windows Command Shell | Execution |
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1071.004 | Application Layer Protocol: DNS | Command and Control |
| T1136 | Create Account | Persistence |
| T1547 | Boot or Logon Autostart Execution | Persistence |

## References

- [Microsoft Docs - Whoami Command](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/whoami)
- [MITRE ATT&CK - System Owner/User Discovery](https://attack.mitre.org/techniques/T1033/)
- [CISA Alert - Living off the Land Techniques](https://www.cisa.gov/news-events/cybersecurity-advisories/)
