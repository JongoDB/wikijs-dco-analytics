---
title: Stowaway
type: tool
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1071", "T1071.001", "T1090", "T1547"]
---

# Stowaway

## Overview

Stowaway is an open-source multi-hop proxy tool used post-compromise to tunnel command and control (C2) traffic and bypass network restrictions. This tool allows attackers to create complex proxy chains and pivot through multiple compromised systems to maintain persistent access to target networks.

## Observed Behavior & Capabilities

### Primary Functions
- **Multi-Hop Proxy**: Creates proxy chains through multiple compromised systems
- **C2 Tunneling**: Tunnels C2 traffic through proxy chains
- **Network Pivoting**: Enables lateral movement through network segments
- **Traffic Obfuscation**: Hides C2 traffic within proxy chains

### Key Capabilities
- **Controller/Agent Model**: Centralized control with distributed agents
- **Multi-Platform Support**: Supports Windows and Linux systems
- **HTTP/SOCKS Proxy**: Supports various proxy protocols
- **File Transfer**: Upload and download files through proxy chains

## Technical Details

### Architecture
- **Type**: Multi-hop Proxy Tool
- **Platform**: Windows and Linux
- **Communication**: HTTP and SOCKS protocols
- **Deployment**: Binary agents deployed on compromised systems

### Network Behavior
- **Protocols**: HTTP and SOCKS for proxy communication
- **Default Port**: 4441 (configurable)
- **User Agent**: Go-http-client/1.1 (default Go HTTP client)
- **Encryption**: May use encryption for proxy communications

## Detection Methods

### Network Detection
```suricata
# Stowaway HTTP/SOCKS C2
alert tcp any any -> any 4441 (msg:"Stowaway - HTTP/SOCKS C2 Communication"; flow:established,to_server; sid:2025104012; rev:1;)

# Stowaway Go HTTP client
alert http any any -> any any (msg:"Stowaway - Go HTTP Client"; http_user_agent; content:"Go-http-client/1.1"; sid:2025104013; rev:1;)
```

### Host Detection
```powershell
# Stowaway process detection
Get-Process | Where-Object {$_.ProcessName -match "agent" -or $_.ProcessName -match "stowaway"}

# Stowaway file detection
Get-ChildItem -Path "C:\temp", "C:\Users\*\AppData\Local\Temp" -Recurse -Name "*agent*" -ErrorAction SilentlyContinue
```

### Behavioral Indicators
- **Agent Binaries**: Presence of "agent" or "agentu.exe" files
- **Temp Directory Usage**: Files in /tmp, /var/tmp, or %TEMP% directories
- **Go HTTP Client**: Use of Go default HTTP client user agent
- **Proxy Connections**: Unusual proxy connections on port 4441

## Hunting Queries

### Splunk Searches
```splunk
# Stowaway network activity
index=network* (dest_port="4441" OR user_agent="Go-http-client/1.1") OR (url="*agent*" AND dest_port="4441")
| stats count by src_ip, dest_ip, dest_port, user_agent

# Stowaway process activity
index=sysmon* EventCode=1 (Image="*agent*" OR CommandLine="*agent*" OR Image="*stowaway*")
| stats count by host, user, Image, CommandLine
```

### KQL Queries
```kql
// Stowaway network detection
DeviceNetworkEvents
| where RemotePort == 4441 or InitiatingProcessFileName contains "agent"
| project Timestamp, DeviceName, RemoteUrl, RemotePort, InitiatingProcessFileName

// Stowaway process detection
DeviceProcessEvents
| where FileName contains "agent" or ProcessCommandLine contains "agent"
| project Timestamp, DeviceName, FileName, ProcessCommandLine
```

## IOCs (Indicators of Compromise)

### File Indicators
- **File Names**: agent, agentu.exe, agent.tar, agent.zip
- **File Locations**: /tmp, /var/tmp, %TEMP% directories
- **File Hashes**: [Known Stowaway agent hashes from threat intelligence]

### Network Indicators
- **Ports**: 4441 (default), configurable ports
- **Protocols**: HTTP, SOCKS
- **User Agents**: Go-http-client/1.1
- **Domains**: Suspicious domains hosting Stowaway infrastructure

### Behavioral Indicators
- **Process Names**: Suspicious "agent" processes
- **Network Connections**: Unusual proxy connections
- **File Creation**: Agent binaries in temp directories
- **Command Execution**: Agent execution with specific parameters

## Mitigation Strategies

### Prevention
- **Endpoint Protection**: Deploy EDR solutions with proxy tool detection
- **Network Monitoring**: Monitor for suspicious proxy connections
- **Access Controls**: Implement strict access controls
- **Patch Management**: Keep systems updated with latest security patches

### Detection
- **Network Monitoring**: Monitor for suspicious HTTP/SOCKS traffic
- **Process Monitoring**: Monitor for suspicious agent processes
- **File System Monitoring**: Monitor for suspicious file creation
- **Proxy Monitoring**: Monitor for unusual proxy usage patterns

### Response
- **Incident Response**: Have procedures for proxy tool incidents
- **Forensic Analysis**: Preserve evidence for investigation
- **Network Isolation**: Isolate compromised systems
- **System Recovery**: Use clean backups for system recovery

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1090 | Proxy | Command and Control |
| T1547 | Boot or Logon Autostart Execution | Persistence |

## References

- [Stowaway GitHub Repository](https://github.com/ph4ntonn/Stowaway)
- [CISA Alert - Stowaway Usage](https://www.cisa.gov/news-events/cybersecurity-advisories/)
- [Malpedia - Stowaway](https://malpedia.caad.fkie.fraunhofer.de/details/win.stowaway)
