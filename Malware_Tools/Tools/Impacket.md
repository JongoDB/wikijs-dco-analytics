---
title: Impacket
type: tool
importable: true
exportable: true
last_reviewed: 2025-01-20
mitre_ids: ["T1003", "T1021", "T1055", "T1071", "T1071.001", "T1071.004", "T1550", "T1550.002", "T1558", "T1562"]
---

# Impacket

## Overview

Impacket is a powerful Python library and collection of tools used for network protocol implementation and post-exploitation activities. While it has legitimate uses in penetration testing and security research, it is frequently abused by threat actors for credential theft, lateral movement, and privilege escalation in Windows environments.

## Observed Behavior & Capabilities

### Primary Functions
- **Credential Theft**: Extracts credentials from various sources
- **Lateral Movement**: Facilitates movement across network segments
- **Privilege Escalation**: Enables privilege escalation techniques
- **Protocol Implementation**: Implements various network protocols

### Key Tools
- **psexec.py**: Remote execution via SMB
- **smbexec.py**: SMB-based command execution
- **wmiexec.py**: WMI-based command execution
- **secretsdump.py**: Credential dumping from various sources
- **ntlmrelayx.py**: NTLM relay attacks
- **atexec.py**: Task scheduler-based execution

## Technical Details

### Architecture
- **Python Library**: Core library for protocol implementation
- **Command Line Tools**: Standalone tools for specific tasks
- **Protocol Support**: SMB, SMB2, MSRPC, DCE/RPC, LDAP, and more

### Network Behavior
- **SMB Communication**: Uses SMB protocol for many operations
- **Kerberos Support**: Supports Kerberos authentication
- **NTLM Support**: Supports NTLM authentication
- **Multiple Ports**: Uses various ports depending on protocol

## Detection Methods

### Network Detection
```suricata
alert smb any any -> any any (msg:"Impacket - Potential SMB Exploitation"; content:"|NTLM authentication attempt|"; sid:2025100608; rev:1;)

alert tcp any any -> any 445 (msg:"Impacket - SMB Lateral Movement"; content:"|psexec|"; flow:established,to_server; sid:2025100609; rev:1;)
```

### Host Detection
```powershell
# PowerShell detection for Impacket usage
Get-Process | Where-Object {$_.ProcessName -match "python" -and $_.CommandLine -match "impacket"}

# Check for suspicious SMB connections
Get-NetTCPConnection | Where-Object {$_.LocalPort -eq 445 -or $_.RemotePort -eq 445}
```

### Behavioral Indicators
- **SMB Traffic**: Unusual SMB traffic patterns
- **Python Processes**: Python processes with suspicious command lines
- **Service Creation**: Creation of services via SMB
- **Credential Access**: Attempts to access credential stores

## Hunting Queries

### Splunk Search
```splunk
index=wineventlog* (EventCode=7045 OR EventCode=4697) (Image="*python*" OR CommandLine="*impacket*")
| stats count by host, user, Image, CommandLine
```

### KQL Query
```kql
DeviceProcessEvents
| where ProcessCommandLine contains "impacket" or ProcessCommandLine contains "psexec.py"
| project Timestamp, DeviceName, AccountName, ProcessCommandLine
```

## Mitigation Strategies

### Prevention
- **Network Segmentation**: Implement strict network segmentation
- **SMB Security**: Disable SMBv1 and implement SMB signing
- **Credential Protection**: Implement Credential Guard and LAPS
- **Access Controls**: Implement least privilege access principles

### Detection
- **Endpoint Protection**: Deploy EDR solutions with Impacket detection
- **Network Monitoring**: Monitor for suspicious SMB traffic patterns
- **Log Analysis**: Regular analysis of Windows security logs

### Response
- **Incident Response**: Have procedures for lateral movement incidents
- **Credential Rotation**: Implement credential rotation policies
- **Forensic Analysis**: Preserve evidence for investigation

## Related MITRE ATT&CK Techniques

| Technique | Description | Tactic |
|-----------|-------------|---------|
| T1003 | OS Credential Dumping | Credential Access |
| T1021 | Remote Services | Lateral Movement |
| T1055 | Process Injection | Defense Evasion |
| T1071 | Application Layer Protocol | Command and Control |
| T1071.001 | Application Layer Protocol: Web Protocols | Command and Control |
| T1071.004 | Application Layer Protocol: DNS | Command and Control |
| T1550 | Use Alternate Authentication Material | Defense Evasion |
| T1550.002 | Use Alternate Authentication Material: Pass the Hash | Defense Evasion |
| T1558 | Steal or Forge Kerberos Tickets | Credential Access |
| T1562 | Impair Defenses | Defense Evasion |

## References

- [Impacket GitHub Repository](https://github.com/fortra/impacket)
- [MITRE ATT&CK - Remote Services](https://attack.mitre.org/techniques/T1021/)
- [CISA Alert - Lateral Movement Techniques](https://www.cisa.gov/news-events/cybersecurity-advisories/)
